<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>Foloneo Pro - G√©n√©rateur de Devis Commercial</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body { font-family:'Inter',sans-serif; -webkit-font-smoothing:antialiased; background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%); color:white; overflow-x:hidden; min-height:100vh; }
        .glass { background:rgba(255,255,255,0.05); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.1); box-shadow:0 8px 32px rgba(0,0,0,0.37); }
        .glass-card { background:rgba(255,255,255,0.08); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.12); border-radius:20px; box-shadow:0 8px 32px rgba(0,0,0,0.37); transition:all 0.3s; }
        .glass-card:hover { transform:translateY(-2px); box-shadow:0 12px 40px rgba(0,0,0,0.5); border-color:rgba(255,255,255,0.2); }
        .btn-3d { position:relative; padding:12px 24px; border:none; border-radius:12px; font-weight:600; cursor:pointer; transition:all 0.2s; box-shadow:0 4px 0 rgba(0,0,0,0.2),0 8px 16px rgba(0,0,0,0.3); }
        .btn-3d:active { transform:translateY(4px); box-shadow:0 0 0 rgba(0,0,0,0.2),0 4px 8px rgba(0,0,0,0.3); }
        .btn-3d:hover { transform:translateY(-2px); box-shadow:0 6px 0 rgba(0,0,0,0.2),0 12px 24px rgba(0,0,0,0.4); }
        .btn-primary { background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%); color:white; }
        .btn-success { background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:white; }
        .btn-danger { background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%); color:white; }
        .btn-add { width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; background:linear-gradient(135deg,#3b82f6,#2563eb); box-shadow:0 4px 0 #1e40af,0 8px 16px rgba(59,130,246,0.4); transition:all 0.2s; }
        .btn-add:hover { transform:translateY(-2px) scale(1.05); box-shadow:0 6px 0 #1e40af,0 12px 24px rgba(59,130,246,0.6); }
        .btn-add:active { transform:translateY(4px) scale(0.95); box-shadow:0 0 0 #1e40af,0 4px 8px rgba(59,130,246,0.4); }
        .btn-add.added { animation:pulse 0.6s; }
        @keyframes pulse { 0%,100% { background:linear-gradient(135deg,#3b82f6,#2563eb); transform:scale(1); } 50% { background:linear-gradient(135deg,#10b981,#059669); transform:scale(1.15); } }
        .input-field { width:100%; padding:14px 20px; background:rgba(255,255,255,0.08); border:2px solid rgba(255,255,255,0.1); border-radius:12px; color:white; font-size:16px; transition:all 0.3s; }
        .input-field:focus { outline:none; border-color:#3b82f6; background:rgba(255,255,255,0.12); box-shadow:0 0 0 4px rgba(59,130,246,0.1); }
        .input-field::placeholder { color:rgba(255,255,255,0.4); }
        .product-card { background:rgba(255,255,255,0.06); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.1); border-radius:16px; padding:16px; transition:all 0.3s; cursor:pointer; }
        .product-card:hover { transform:translateY(-4px) scale(1.02); background:rgba(255,255,255,0.1); border-color:rgba(59,130,246,0.5); box-shadow:0 12px 32px rgba(59,130,246,0.3); }
        .product-card.selected { border-color:#3b82f6; background:rgba(59,130,246,0.15); }
        .toast { position:fixed; top:90px; right:20px; background:linear-gradient(135deg,#10b981,#059669); color:white; padding:16px 24px; border-radius:12px; box-shadow:0 8px 32px rgba(16,185,129,0.4); display:flex; align-items:center; gap:12px; z-index:10000; animation:slideIn 0.3s; }
        @keyframes slideIn { from { transform:translateX(400px); opacity:0; } to { transform:translateX(0); opacity:1; } }
        .badge { position:absolute; top:-8px; right:-8px; background:linear-gradient(135deg,#ef4444,#dc2626); color:white; border-radius:50%; width:28px; height:28px; display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:bold; box-shadow:0 4px 12px rgba(239,68,68,0.5); animation:badgePulse 2s infinite; }
        @keyframes badgePulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
        .stat-card { background:linear-gradient(135deg,rgba(59,130,246,0.2),rgba(37,99,235,0.1)); backdrop-filter:blur(10px); border:1px solid rgba(59,130,246,0.3); border-radius:20px; padding:24px; transition:all 0.3s; }
        .stat-card:hover { transform:translateY(-4px); border-color:rgba(59,130,246,0.6); box-shadow:0 12px 32px rgba(59,130,246,0.3); }
        .category-pill { padding:8px 16px; border-radius:20px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); cursor:pointer; transition:all 0.2s; white-space:nowrap; font-size:14px; }
        .category-pill:hover { background:rgba(59,130,246,0.2); border-color:rgba(59,130,246,0.5); }
        .category-pill.active { background:linear-gradient(135deg,#3b82f6,#2563eb); border-color:transparent; box-shadow:0 4px 12px rgba(59,130,246,0.4); }
        .mobile-bar { position:fixed; bottom:0; left:0; right:0; background:rgba(15,23,42,0.95); backdrop-filter:blur(12px); border-top:1px solid rgba(255,255,255,0.1); padding:12px; z-index:1000; box-shadow:0 -4px 20px rgba(0,0,0,0.3); }
        .mobile-nav-btn { flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; padding:8px; border-radius:12px; transition:all 0.2s; color:rgba(255,255,255,0.6); }
        .mobile-nav-btn.active { background:rgba(59,130,246,0.2); color:#3b82f6; }
        ::-webkit-scrollbar { width:8px; height:8px; }
        ::-webkit-scrollbar-track { background:rgba(255,255,255,0.05); border-radius:4px; }
        ::-webkit-scrollbar-thumb { background:rgba(59,130,246,0.5); border-radius:4px; }
        ::-webkit-scrollbar-thumb:hover { background:rgba(59,130,246,0.7); }
        .fade-in { animation:fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .content-padding { padding-bottom:100px; }
        @media (min-width:769px) { .mobile-bar { display:none; } .content-padding { padding-bottom:20px; } }
        .quantity-btn { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); transition:all 0.2s; cursor:pointer; }
        .quantity-btn:hover { background:rgba(59,130,246,0.3); border-color:#3b82f6; }
        .quantity-btn:active { transform:scale(0.9); }
        .template-card { background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3); border-radius:16px; padding:20px; cursor:pointer; transition:all 0.3s; }
        .template-card:hover { background:rgba(139,92,246,0.2); border-color:rgba(139,92,246,0.5); transform:translateY(-2px); box-shadow:0 8px 24px rgba(139,92,246,0.3); }
        .search-highlight { background:rgba(59,130,246,0.3); padding:2px 4px; border-radius:4px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
// DONN√âES PRODUITS AJAX
const ajaxProducts = [
    { id: 'ajax1', name: 'Hub', category: 'Centrales', price: 108.09, description: 'Centrale IP-GPRS 2G - Ethernet - Gsm/Gprs  (alimentation et cable ethernet fourn...', icon: 'üè¢' },
    { id: 'ajax2', name: 'Hub 2', category: 'Centrales', price: 151.79, description: 'Centrale IP-GPRS 2G (compatible MotionCam) - Ethernet - Gsm/Gprs  (alimentation ...', icon: 'üè¢' },
    { id: 'ajax3', name: 'Hub 2 - 4G', category: 'Centrales', price: 227.13, description: 'Centrale IP-GPRS 4G (compatible MotionCam) - Ethernet - Gsm/Gprs  (alimentation ...', icon: 'üè¢' },
    { id: 'ajax4', name: 'Hub 2 Plus', category: 'Centrales', price: 259.4, description: 'Centrale IP-GPRS 2G/3G/4G Compatible MotionCam) - Ethernet -module wifi integr√© ...', icon: 'üè¢' },
    { id: 'ajax5', name: 'DoorProtect', category: 'D√©tecteurs d'ouverture', price: 23.9, description: 'Detecteur d\'ouverture  - Deux aimants - CR123A batterie (pr√©-install√©e) - 1 ent...', icon: 'üö™' },
    { id: 'ajax6', name: 'DoorProtectPlus', category: 'D√©tecteurs d'ouverture', price: 35.88, description: 'Detecteur d\'ouverture, de vibration et d\'inclinaison - Deux aimants - CR123A b...', icon: 'üö™' },
    { id: 'ajax7', name: 'MotionProtect', category: 'D√©tecteurs de mouvement', price: 40.55, description: 'Detecteur infrarouge - Anti animaux - CR123A batterie (pr√©-install√©e)', icon: 'üëÅÔ∏è' },
    { id: 'ajax8', name: 'MotionProtect Plus', category: 'D√©tecteurs de mouvement', price: 55.64, description: 'Detecteur infrarouge double technologie -  Anti animaux - CR123A batterie (pr√©-i...', icon: 'üëÅÔ∏è' },
    { id: 'ajax9', name: 'CombiProtect', category: 'D√©tecteurs de mouvement', price: 56.12, description: 'Detecteur infrarouge et bris de vitre -  Anti animaux - CR123A batterie (pr√©-ins...', icon: 'üëÅÔ∏è' },
    { id: 'ajax10', name: 'MotionProtect Outdoor', category: 'D√©tecteurs de mouvement', price: 140.31, description: 'Detecteur infrarouge exterieur          - Double faisceau           - Anti-mask ...', icon: 'üëÅÔ∏è' },
    { id: 'ajax11', name: 'Curtainprotect', category: 'D√©tecteurs de mouvement', price: 47.27, description: 'D√©tecteur PIR de type rideau Ajax  Port√©e de d√©tection configurable de 6 √† 15 m', icon: 'üëÅÔ∏è' },
    { id: 'ajax12', name: 'DualCurtain Outdoor', category: 'D√©tecteurs de mouvement', price: 143.45, description: 'Detecteur infrarouge exterieur rideau          -4 capteurs PIR           - Anti-...', icon: 'üëÅÔ∏è' },
    { id: 'ajax13', name: 'Curtain Outdoor Jeweller', category: 'D√©tecteurs de mouvement', price: 102.6, description: '', icon: 'üëÅÔ∏è' },
    { id: 'ajax14', name: 'MotionCam', category: 'D√©tecteurs cam√©ra', price: 92.52, description: 'Detecteur infrarouge avec camera - Anti animaux - 2 CR123A batterie (pr√©-install...', icon: 'üì∑' },
    { id: 'ajax15', name: 'MotionCam Outdoor', category: 'D√©tecteurs cam√©ra', price: 172.58, description: 'Detecteur infrarouge cam√©ra exterieur         - Double faisceau              -  ...', icon: 'üì∑' },
    { id: 'ajax16', name: 'GlassProtect', category: 'D√©tecteurs bris de vitre', price: 40.55, description: 'Detecteur de bris de vitre - 1 entr√©e contact sec - CR123A batterie (pr√©-install...', icon: 'üî®' },
    { id: 'ajax17', name: 'FireProtect', category: 'D√©tecteurs incendie', price: 47.27, description: 'Detecteur de fum√©e - capteur de temp√©rature integr√© - 2 x piles de CR2032 (pr√©in...', icon: 'üî•' },
    { id: 'ajax18', name: 'FireProtect Plus', category: 'D√©tecteurs incendie', price: 72.24, description: 'Detecteur de fum√©e et CO2 - capteur de temp√©rature integr√© - 2 x piles de CR2032...', icon: 'üî•' },
    { id: 'ajax19', name: 'LeaksProtect', category: 'D√©tecteurs inondation', price: 32.22, description: 'Detecteur d\'innondation - Deux piles AAA (pr√©install√©es)', icon: 'üíß' },
    { id: 'ajax20', name: 'StreetSiren', category: 'Sir√®nes', price: 176.74, description: 'Sir√®ne exterieure avec flash     - Quatre CR123A batteries (pr√©-install√©es)', icon: 'üö®' },
    { id: 'ajax21', name: 'StreetSirenPlus NFA2P', category: 'Sir√®nes', price: 137.25, description: 'Sir√®ne exterieure NFA2P avec flash     - Quatre CR123A batteries (pr√©-install√©es...', icon: 'üö®' },
    { id: 'ajax22', name: 'StreetSirencustom', category: 'Sir√®nes', price: 79.53, description: 'Sir√®ne exterieure avec flash avec couvercle personnalisable     - Quatre CR123A ...', icon: 'üö®' },
    { id: 'ajax23', name: 'HomeSIren', category: 'Sir√®nes', price: 40.55, description: 'Sir√®ne interieure     - Deux CR123A batteries (pr√©-install√©es)', icon: 'üö®' },
    { id: 'ajax24', name: 'KeyPad', category: 'Claviers', price: 63.93, description: 'Clavier tactile - 4 piles AAA (pr√©install√©es)', icon: '‚å®Ô∏è' },
    { id: 'ajax25', name: 'KeyPad Plus', category: 'Claviers', price: 81.05, description: 'Clavier tactile avec lecteur de badge - 4 piles AAA (pr√©install√©es)', icon: '‚å®Ô∏è' },
    { id: 'ajax26', name: 'SpaceControl', category: 'T√©l√©commandes', price: 20.27, description: 'T√©l√©commande 4 boutons bidirectionnelle - CR123A batterie (pr√©-install√©e)', icon: 'üéÆ' },
    { id: 'ajax27', name: 'Rex / Range extender', category: 'R√©p√©teurs', price: 80.59, description: 'R√©p√©teur radio', icon: 'üì°' },
    { id: 'ajax28', name: 'Rex 2/ Range extender', category: 'R√©p√©teurs', price: 115.37, description: 'R√©p√©teur radio comptatible photos', icon: 'üì°' },
    { id: 'ajax29', name: 'WallSwitch', category: 'Relais et modules', price: 28.6, description: 'Relais de controle √† distance 110~240v - Compteur de consommation', icon: '‚ö°' },
    { id: 'ajax30', name: 'Relay', category: 'Relais et modules', price: 28.6, description: 'Relais de controle √† distance (contact sec) - Entr√©e d\'alimentation 7~24V', icon: '‚ö°' },
    { id: 'ajax31', name: 'Multitransmitter-3EOL', category: 'Relais et modules', price: 99.81, description: 'Module qui permet l\'int√©gration au syst√®me  Ajax d\'appareils tiers c√¢bl√©s 18 z...', icon: '‚ö°' },
    { id: 'ajax32', name: 'DC12V-PCB2', category: 'Relais et modules', price: 16.08, description: 'Module d\'alimentation 12 VDC Compatible avec Ajax le Hub 2 Tension d\'entr√©e 8~...', icon: '‚ö°' },
    { id: 'ajax33', name: 'DC6V-PCB2', category: 'Relais et modules', price: 16.08, description: 'Module d\'alimentation 12 VDC Compatible avec Ajax le Hub 2 et rex 2 Tension d\'...', icon: '‚ö°' },
    { id: 'ajax34', name: 'Socket', category: 'Relais et modules', price: 49.88, description: 'Prise intelligente connect√©e', icon: '‚ö°' },
    { id: 'ajax35', name: 'Transmitter', category: 'Relais et modules', price: 32.22, description: 'Transmetteur universel - entr√©e filaire et autoprotection (accelerometre) - 3 pi...', icon: '‚ö°' },
    { id: 'ajax36', name: 'Button', category: 'Boutons panic', price: 20.28, description: 'Bouton panic', icon: 'üÜò' },
    { id: 'ajax37', name: 'Doublebutton', category: 'Boutons panic', price: 20.28, description: 'Double Bouton panic', icon: 'üÜò' },
    { id: 'ajax38', name: 'Hood', category: 'Accessoires', price: 7.8, description: 'Casquette de protection pour Motionprotect Outdoor', icon: 'üîß' },
    { id: 'ajax39', name: 'TAG', category: 'Accessoires', price: 40.55, description: 'Tag d\'acc√®s pour Keypad plus - lot de10', icon: 'üîß' },
    { id: 'ajax40', name: 'PASS', category: 'Accessoires', price: 37.94, description: 'Pass d\'acc√®s pour Keypad plus - lot de10', icon: 'üîß' },
    { id: 'ajax41', name: 'DinHolder', category: 'Accessoires', price: 6.0, description: 'Support pour rail Din', icon: 'üîß' },
    { id: 'ajax42', name: 'Brandplates', category: 'Accessoires', price: 51.98, description: 'Pack de 10 couvercles personnalisable', icon: 'üîß' },
    { id: 'ajax43', name: 'Holder', category: 'Accessoires', price: 3.66, description: 'Support pour bouton d\'urgence', icon: 'üîß' },
    { id: 'ajax44', name: 'MB100', category: 'Accessoires', price: 16.2, description: 'Rotule de fixation a fixer sur les MOTIONCAMOUTDOOR', icon: 'üîß' },
    { id: 'ajax45', name: 'XTO 2.0', category: 'Kits', price: 459.0, description: 'XTO 2.0 KIT CHANTIER - 1 coffret 430x330x200 preperc√© avec serrure √† monter - 1 ...', icon: 'üì¶' },
    { id: 'ajax46', name: 'XTO 2.0 - 4G', category: 'Kits', price: 535.5, description: 'XTO 2.0 -4G KIT CHANTIER - 1 coffret 430x330x200 preperc√© avec serrure √† monter ...', icon: 'üì¶' },
    { id: 'ajax47', name: 'REX2 XTENDER', category: 'Kits', price: 423.0, description: 'KIT REX2 XTENDER ( pour augmenter la port√©e radio) - 1 coffret 430x330x200 prepe...', icon: 'üì¶' },
    { id: 'ajax48', name: 'COFFRET', category: 'Kits', price: 166.5, description: 'COFFRET SEUL               - 1 coffret 430x330x200 preperc√©                     ...', icon: 'üì¶' },
    { id: 'ajax49', name: 'PILE 6V 960AH', category: 'Kits', price: 134.1, description: 'PILE 6V 960AH ZINC AIR (a utilisation unique) Autonomie moyenne de 14 mois', icon: 'üì¶' },
    { id: 'ajax50', name: 'Lifequality', category: 'Nouveaut√©s', price: 208.47, description: 'Moniteur de temp√©rature, humidit√© et CO2', icon: '‚ú®' },
    { id: 'ajax51', name: 'Lightcore - 1G', category: 'Nouveaut√©s', price: 46.65, description: 'Interrupteur simple', icon: '‚ú®' },
    { id: 'ajax52', name: 'Lightcore - 2G', category: 'Nouveaut√©s', price: 53.78, description: 'Interrupteur double', icon: '‚ú®' },
    { id: 'ajax53', name: 'Lightcore - 2W', category: 'Nouveaut√©s', price: 49.98, description: 'Interrupteur va et vient', icon: '‚ú®' },
    { id: 'ajax54', name: 'SOLOBUTTON - 1G2W', category: 'Nouveaut√©s', price: 8.09, description: 'Panneau tactil pour interrupteur   compatible Lightcore 1G et Lightcore-2W', icon: '‚ú®' },
    { id: 'ajax55', name: 'SOLOBUTTON - 2G', category: 'Nouveaut√©s', price: 9.05, description: 'Panneau tactil pour interrupteur   compatible Lightcore 2G', icon: '‚ú®' },
];

// DONN√âES PRODUITS DAHUA
const dahuaProducts = [
    { id: 'dahua1', name: 'NVR 4 canaux', category: 'Enregistreurs', price: 299, description: 'Enregistreur 4K, 4 cam√©ras IP', icon: 'üìπ' },
    { id: 'dahua2', name: 'NVR 8 canaux', category: 'Enregistreurs', price: 449, description: 'Enregistreur 4K, 8 cam√©ras IP', icon: 'üìπ' },
    { id: 'dahua3', name: 'Cam√©ra D√¥me 4MP', category: 'Cam√©ras', price: 159, description: 'Cam√©ra d√¥me 4MP', icon: 'üì∑' },
    { id: 'dahua4', name: 'Cam√©ra Tube 4MP', category: 'Cam√©ras', price: 179, description: 'Cam√©ra tube IR 30m', icon: 'üì∑' },
    { id: 'dahua5', name: 'Cam√©ra PTZ 2MP', category: 'Cam√©ras', price: 599, description: 'Cam√©ra motoris√©e zoom x20', icon: 'üì∑' },
    { id: 'dahua6', name: 'Disque dur 2To', category: 'Accessoires', price: 89, description: 'HDD surveillance', icon: 'üíæ' },
    { id: 'dahua7', name: 'Switch PoE 8 ports', category: 'Accessoires', price: 149, description: 'Switch PoE', icon: 'üîå' },
    { id: 'dahua8', name: '√âcran 22" LED', category: 'Accessoires', price: 199, description: 'Moniteur Full HD', icon: 'üñ•Ô∏è' },
];

        // Templates de devis pr√©d√©finis
        const quoteTemplates = [
            { id: 't1', name: 'üè† Alarme R√©sidentielle', description: 'Pack alarme maison standard', items: ['ajax2', 'ajax7', 'ajax7', 'ajax7', 'ajax5', 'ajax5', 'ajax23', 'ajax25'] },
            { id: 't2', name: '‚≠ê Alarme Premium', description: 'Pack alarme haut de gamme', items: ['ajax4', 'ajax8', 'ajax8', 'ajax14', 'ajax14', 'ajax6', 'ajax20', 'ajax25'] },
            { id: 't3', name: 'üìπ Vid√©o 4 Cam√©ras', description: 'Installation vid√©osurveillance 4 cam√©ras', items: ['dahua1', 'dahua3', 'dahua3', 'dahua4', 'dahua4', 'dahua6', 'dahua7'] },
            { id: 't4', name: 'üìπ Vid√©o 8 Cam√©ras', description: 'Installation vid√©osurveillance 8 cam√©ras', items: ['dahua2', 'dahua3', 'dahua3', 'dahua3', 'dahua3', 'dahua4', 'dahua4', 'dahua4', 'dahua4', 'dahua6', 'dahua7', 'dahua8'] },
            { id: 't5', name: 'üèóÔ∏è Kit Chantier', description: 'Protection chantier temporaire', items: ['ajax3', 'ajax10', 'ajax10', 'ajax20'] },
        ];

        // Initialisation
        const initializeData = () => {
            if (!localStorage.getItem('foloneo_users')) {
                localStorage.setItem('foloneo_users', JSON.stringify([{
                    id: '1', username: 'admin', password: 'admin123', email: 'admin@foloneo.fr',
                    role: 'admin', active: true, createdAt: new Date().toISOString()
                }]));
            }
            if (!localStorage.getItem('foloneo_quotes')) localStorage.setItem('foloneo_quotes', JSON.stringify([]));
        };

        // Toast Notification
        function Toast({ message, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            return <div className="toast"><span className="text-2xl">‚úì</span><span className="font-semibold">{message}</span></div>;
        }

        // Login Screen
        function LoginScreen({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                const users = JSON.parse(localStorage.getItem('foloneo_users') || '[]');
                const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());
                if (!user || user.password !== password) { setError('Identifiant ou mot de passe incorrect'); return; }
                if (!user.active) { setError('Compte d√©sactiv√©'); return; }
                localStorage.setItem('foloneo_current_user', JSON.stringify(user));
                onLogin(user);
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-card max-w-md w-full p-8 fade-in">
                        <div className="text-center mb-8">
                            <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl mb-6 shadow-lg">
                                <span className="text-4xl font-bold">F</span>
                            </div>
                            <h1 className="text-3xl font-bold mb-2">Foloneo Pro</h1>
                            <p className="text-gray-400">G√©n√©rateur de Devis Commercial</p>
                        </div>
                        <form onSubmit={handleLogin} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium mb-2">Identifiant</label>
                                <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="input-field" placeholder="Votre identifiant" required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Mot de passe</label>
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="input-field" placeholder="Votre mot de passe" required />
                            </div>
                            {error && <div className="bg-red-500/20 border border-red-500/50 text-red-200 px-4 py-3 rounded-xl text-sm">{error}</div>}
                            <button type="submit" className="btn-3d btn-primary w-full">Se connecter</button>
                        </form>
                    </div>
                </div>
            );
        }

        // Dashboard
        function Dashboard({ quotes }) {
            const total = quotes.length;
            const revenue = quotes.reduce((s, q) => s + q.total, 0);
            const avg = total > 0 ? revenue / total : 0;

            return (
                <div className="space-y-6 fade-in">
                    <h2 className="text-3xl font-bold">üìä Tableau de bord</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="stat-card">
                            <div className="text-4xl mb-2">üìù</div>
                            <div className="text-gray-400 text-sm mb-1">Total Devis</div>
                            <div className="text-4xl font-bold">{total}</div>
                        </div>
                        <div className="stat-card">
                            <div className="text-4xl mb-2">üí∞</div>
                            <div className="text-gray-400 text-sm mb-1">Chiffre d'affaires</div>
                            <div className="text-4xl font-bold">{revenue.toFixed(0)} ‚Ç¨</div>
                        </div>
                        <div className="stat-card">
                            <div className="text-4xl mb-2">üìà</div>
                            <div className="text-gray-400 text-sm mb-1">Devis moyen</div>
                            <div className="text-4xl font-bold">{avg.toFixed(0)} ‚Ç¨</div>
                        </div>
                    </div>
                    {quotes.length > 0 && (
                        <div className="glass-card p-6">
                            <h3 className="text-xl font-bold mb-4">üìã Derniers devis</h3>
                            <div className="space-y-3">
                                {quotes.slice(-5).reverse().map(q => (
                                    <div key={q.id} className="flex justify-between items-center p-4 bg-white/5 rounded-xl hover:bg-white/10 transition">
                                        <div>
                                            <div className="font-semibold">{q.clientName}</div>
                                            <div className="text-sm text-gray-400">{new Date(q.date).toLocaleDateString('fr-FR')}</div>
                                        </div>
                                        <div className="text-2xl font-bold text-blue-400">{q.total.toFixed(2)} ‚Ç¨</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Quote Creator
        function QuoteCreator({ onSave, onBack }) {
            const [clientName, setClientName] = useState('');
            const [clientAddress, setClientAddress] = useState('');
            const [clientPhone, setClientPhone] = useState('');
            const [cart, setCart] = useState([]);
            const [discount, setDiscount] = useState(0);
            const [activeTab, setActiveTab] = useState('ajax');
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [toast, setToast] = useState(null);
            const [addedProductId, setAddedProductId] = useState(null);
            const [showTemplates, setShowTemplates] = useState(false);

            const allProducts = activeTab === 'ajax' ? ajaxProducts : dahuaProducts;
            const categories = ['all', ...new Set(allProducts.map(p => p.category))];

            const filteredProducts = allProducts.filter(p => {
                const matchSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                   p.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchCategory = selectedCategory === 'all' || p.category === selectedCategory;
                return matchSearch && matchCategory;
            });

            const addToCart = (product) => {
                setAddedProductId(product.id);
                setTimeout(() => setAddedProductId(null), 600);

                const existing = cart.find(item => item.id === product.id);
                if (existing) {
                    setCart(cart.map(item => item.id === product.id ? {...item, quantity: item.quantity + 1} : item));
                    setToast(`${product.name} x${existing.quantity + 1}`);
                } else {
                    setCart([...cart, {...product, quantity: 1}]);
                    setToast(`${product.name} ajout√©`);
                }
            };

            const updateQuantity = (id, quantity) => {
                if (quantity <= 0) {
                    setCart(cart.filter(item => item.id !== id));
                } else {
                    setCart(cart.map(item => item.id === id ? {...item, quantity} : item));
                }
            };

            const applyTemplate = (template) => {
                const templateProducts = template.items.map(id => {
                    const product = [...ajaxProducts, ...dahuaProducts].find(p => p.id === id);
                    return product;
                }).filter(Boolean);

                const newCart = {};
                templateProducts.forEach(p => {
                    if (newCart[p.id]) {
                        newCart[p.id].quantity++;
                    } else {
                        newCart[p.id] = {...p, quantity: 1};
                    }
                });

                setCart(Object.values(newCart));
                setShowTemplates(false);
                setToast(`Template "${template.name}" appliqu√©`);
            };

            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discountAmount = subtotal * (discount / 100);
            const total = subtotal - discountAmount;

            const handleSave = () => {
                if (!clientName) { alert('Veuillez entrer le nom du client'); return; }
                if (cart.length === 0) { alert('Ajoutez des produits au devis'); return; }

                const quote = {
                    id: Date.now().toString(),
                    date: new Date().toISOString(),
                    clientName, clientAddress, clientPhone,
                    items: cart, subtotal, discount, discountAmount, total
                };

                onSave(quote);
                setClientName(''); setClientAddress(''); setClientPhone('');
                setCart([]); setDiscount(0);
            };

            return (
                <div className="space-y-6 fade-in">
                    {toast && <Toast message={toast} onClose={() => setToast(null)} />}
                    
                    <div className="flex items-center justify-between">
                        <h2 className="text-3xl font-bold">üìù Nouveau Devis</h2>
                        <button onClick={onBack} className="btn-3d btn-primary">‚Üê Retour</button>
                    </div>

                    {/* Infos client */}
                    <div className="glass-card p-6">
                        <h3 className="text-lg font-bold mb-4">üë§ Client</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" value={clientName} onChange={(e) => setClientName(e.target.value)} className="input-field" placeholder="Nom du client *" />
                            <input type="text" value={clientAddress} onChange={(e) => setClientAddress(e.target.value)} className="input-field" placeholder="Adresse" />
                            <input type="tel" value={clientPhone} onChange={(e) => setClientPhone(e.target.value)} className="input-field" placeholder="T√©l√©phone" />
                        </div>
                    </div>

                    {/* Templates */}
                    <div className="glass-card p-6">
                        <button onClick={() => setShowTemplates(!showTemplates)} className="btn-3d btn-primary w-full">
                            ‚ö° {showTemplates ? 'Masquer' : 'Utiliser'} un template
                        </button>
                        {showTemplates && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                                {quoteTemplates.map(t => (
                                    <div key={t.id} onClick={() => applyTemplate(t)} className="template-card">
                                        <div className="text-3xl mb-2">{t.name.split(' ')[0]}</div>
                                        <div className="font-bold mb-1">{t.name.substring(2)}</div>
                                        <div className="text-sm text-gray-400">{t.description}</div>
                                        <div className="text-xs text-gray-500 mt-2">{t.items.length} produits</div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Produits */}
                    <div className="glass-card p-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold">üõí Produits</h3>
                            {cart.length > 0 && (
                                <div className="relative">
                                    <span className="text-2xl">üõí</span>
                                    <span className="badge">{cart.length}</span>
                                </div>
                            )}
                        </div>

                        {/* Onglets */}
                        <div className="flex gap-2 mb-4">
                            <button onClick={() => {setActiveTab('ajax'); setSelectedCategory('all');}} className={`btn-3d flex-1 ${activeTab === 'ajax' ? 'btn-primary' : 'bg-gray-700'}`}>Ajax System (55)</button>
                            <button onClick={() => {setActiveTab('dahua'); setSelectedCategory('all');}} className={`btn-3d flex-1 ${activeTab === 'dahua' ? 'btn-primary' : 'bg-gray-700'}`}>Dahua (8)</button>
                        </div>

                        {/* Recherche */}
                        <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="input-field mb-4" placeholder="üîç Rechercher un produit..." />

                        {/* Filtres cat√©gories */}
                        <div className="flex gap-2 mb-4 overflow-x-auto pb-2">
                            {categories.map(cat => (
                                <button key={cat} onClick={() => setSelectedCategory(cat)} className={`category-pill ${selectedCategory === cat ? 'active' : ''}`}>
                                    {cat === 'all' ? 'üì¶ Tous' : cat}
                                </button>
                            ))}
                        </div>

                        {/* Liste produits */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-96 overflow-y-auto">
                            {filteredProducts.map(p => (
                                <div key={p.id} className={`product-card ${addedProductId === p.id ? 'selected' : ''}`}>
                                    <div className="flex justify-between items-start mb-2">
                                        <div className="text-2xl">{p.icon}</div>
                                        <button onClick={() => addToCart(p)} className={`btn-add ${addedProductId === p.id ? 'added' : ''}`}>+</button>
                                    </div>
                                    <div className="font-bold text-sm mb-1">{p.name}</div>
                                    <div className="text-xs text-gray-400 mb-2 line-clamp-2">{p.description}</div>
                                    <div className="text-lg font-bold text-blue-400">{p.price.toFixed(2)} ‚Ç¨</div>
                                </div>
                            ))}
                        </div>
                        {filteredProducts.length === 0 && (
                            <div className="text-center py-8 text-gray-400">Aucun produit trouv√©</div>
                        )}
                    </div>

                    {/* Panier */}
                    {cart.length > 0 && (
                        <div className="glass-card p-6">
                            <h3 className="text-lg font-bold mb-4">üõçÔ∏è Panier ({cart.length} produits)</h3>
                            <div className="space-y-3 max-h-64 overflow-y-auto mb-4">
                                {cart.map(item => (
                                    <div key={item.id} className="flex justify-between items-center p-3 bg-white/5 rounded-xl">
                                        <div className="flex-1">
                                            <div className="font-semibold">{item.name}</div>
                                            <div className="text-sm text-gray-400">{item.price} ‚Ç¨ √ó {item.quantity}</div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <button onClick={() => updateQuantity(item.id, item.quantity - 1)} className="quantity-btn">-</button>
                                            <span className="w-8 text-center font-bold">{item.quantity}</span>
                                            <button onClick={() => updateQuantity(item.id, item.quantity + 1)} className="quantity-btn">+</button>
                                            <div className="w-24 text-right font-bold text-blue-400">{(item.price * item.quantity).toFixed(2)} ‚Ç¨</div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="space-y-3 border-t border-white/10 pt-4">
                                <div className="flex items-center gap-3">
                                    <label className="text-sm font-medium">Remise %</label>
                                    <input type="number" value={discount} onChange={(e) => setDiscount(Math.max(0, Math.min(100, Number(e.target.value))))} className="input-field w-24" min="0" max="100" />
                                </div>
                                <div className="flex justify-between text-gray-300"><span>Sous-total:</span><span className="font-semibold">{subtotal.toFixed(2)} ‚Ç¨</span></div>
                                {discount > 0 && <div className="flex justify-between text-red-400"><span>Remise ({discount}%):</span><span className="font-semibold">-{discountAmount.toFixed(2)} ‚Ç¨</span></div>}
                                <div className="flex justify-between text-2xl font-bold border-t border-white/10 pt-3"><span>TOTAL:</span><span className="text-green-400">{total.toFixed(2)} ‚Ç¨</span></div>
                            </div>

                            <button onClick={handleSave} className="btn-3d btn-success w-full mt-6">üíæ Enregistrer le devis</button>
                        </div>
                    )}
                </div>
            );
        }

        // Products Manager
        function ProductsManager({ onBack }) {
            const [ajaxProds, setAjaxProds] = useState(ajaxProducts);
            const [dahuaProds, setDahuaProds] = useState(dahuaProducts);
            const [activeTab, setActiveTab] = useState('ajax');
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({});

            const products = activeTab === 'ajax' ? ajaxProds : dahuaProds;

            const startEdit = (product) => {
                setEditingId(product.id);
                setEditForm(product);
            };

            const saveEdit = () => {
                if (activeTab === 'ajax') {
                    setAjaxProds(ajaxProds.map(p => p.id === editingId ? editForm : p));
                } else {
                    setDahuaProds(dahuaProds.map(p => p.id === editingId ? editForm : p));
                }
                setEditingId(null);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex items-center justify-between">
                        <h2 className="text-3xl font-bold">üì¶ Gestion des Produits</h2>
                        <button onClick={onBack} className="btn-3d btn-primary">‚Üê Retour</button>
                    </div>

                    <div className="flex gap-2">
                        <button onClick={() => setActiveTab('ajax')} className={`btn-3d flex-1 ${activeTab === 'ajax' ? 'btn-primary' : 'bg-gray-700'}`}>Ajax ({ajaxProds.length})</button>
                        <button onClick={() => setActiveTab('dahua')} className={`btn-3d flex-1 ${activeTab === 'dahua' ? 'btn-primary' : 'bg-gray-700'}`}>Dahua ({dahuaProds.length})</button>
                    </div>

                    <div className="glass-card p-6">
                        <div className="space-y-3">
                            {products.map(p => (
                                <div key={p.id} className="bg-white/5 rounded-xl p-4">
                                    {editingId === p.id ? (
                                        <div className="space-y-3">
                                            <input type="text" value={editForm.name} onChange={(e) => setEditForm({...editForm, name: e.target.value})} className="input-field" />
                                            <input type="number" step="0.01" value={editForm.price} onChange={(e) => setEditForm({...editForm, price: parseFloat(e.target.value)})} className="input-field" />
                                            <input type="text" value={editForm.description} onChange={(e) => setEditForm({...editForm, description: e.target.value})} className="input-field" />
                                            <div className="flex gap-2">
                                                <button onClick={saveEdit} className="btn-3d btn-success flex-1">‚úì Sauvegarder</button>
                                                <button onClick={() => setEditingId(null)} className="btn-3d btn-danger flex-1">‚úó Annuler</button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="flex justify-between items-center">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="text-2xl">{p.icon}</span>
                                                    <span className="font-bold">{p.name}</span>
                                                    <span className="text-blue-400 font-bold">{p.price.toFixed(2)} ‚Ç¨</span>
                                                </div>
                                                <div className="text-sm text-gray-400">{p.description}</div>
                                                <div className="text-xs text-gray-500 mt-1">{p.category}</div>
                                            </div>
                                            <button onClick={() => startEdit(p)} className="btn-3d btn-primary ml-4">‚úèÔ∏è Modifier</button>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Users Manager
        function UsersManager({ currentUser, onBack }) {
            const [users, setUsers] = useState([]);

            useEffect(() => {
                setUsers(JSON.parse(localStorage.getItem('foloneo_users') || '[]'));
            }, []);

            const toggleActive = (userId) => {
                if (userId === '1') { alert('Impossible de d√©sactiver le compte admin principal'); return; }
                const updated = users.map(u => u.id === userId ? {...u, active: !u.active} : u);
                setUsers(updated);
                localStorage.setItem('foloneo_users', JSON.stringify(updated));
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex items-center justify-between">
                        <h2 className="text-3xl font-bold">üë• Gestion des Utilisateurs</h2>
                        <button onClick={onBack} className="btn-3d btn-primary">‚Üê Retour</button>
                    </div>

                    <div className="glass-card p-6">
                        <div className="space-y-3">
                            {users.map(u => (
                                <div key={u.id} className="bg-white/5 rounded-xl p-4">
                                    <div className="flex justify-between items-center">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className="font-bold">{u.username}</span>
                                                {u.role === 'admin' && <span className="px-2 py-1 bg-blue-500 rounded text-xs">Admin</span>}
                                                {!u.active && <span className="px-2 py-1 bg-red-500 rounded text-xs">Inactif</span>}
                                            </div>
                                            <div className="text-sm text-gray-400">{u.email}</div>
                                            <div className="text-xs text-gray-500 mt-1">Cr√©√© le {new Date(u.createdAt).toLocaleDateString('fr-FR')}</div>
                                        </div>
                                        <button onClick={() => toggleActive(u.id)} className={`btn-3d ${u.active ? 'btn-danger' : 'btn-success'} ml-4`}>
                                            {u.active ? 'üîí D√©sactiver' : 'üîì Activer'}
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Main App
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [quotes, setQuotes] = useState([]);
            const [showUserMenu, setShowUserMenu] = useState(false);

            useEffect(() => {
                initializeData();
                const stored = localStorage.getItem('foloneo_current_user');
                if (stored) setCurrentUser(JSON.parse(stored));
                loadQuotes();
            }, []);

            const loadQuotes = () => {
                setQuotes(JSON.parse(localStorage.getItem('foloneo_quotes') || '[]'));
            };

            const saveQuote = (quote) => {
                const allQuotes = JSON.parse(localStorage.getItem('foloneo_quotes') || '[]');
                allQuotes.push(quote);
                localStorage.setItem('foloneo_quotes', JSON.stringify(allQuotes));
                loadQuotes();
                setCurrentPage('dashboard');
            };

            const handleLogout = () => {
                localStorage.removeItem('foloneo_current_user');
                setCurrentUser(null);
                setShowUserMenu(false);
            };

            if (!currentUser) return <LoginScreen onLogin={setCurrentUser} />;

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <div className="glass fixed top-0 left-0 right-0 z-50 p-4">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setCurrentPage('dashboard')}>
                                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <span className="text-2xl font-bold">F</span>
                                </div>
                                <div>
                                    <div className="text-xl font-bold">Foloneo Pro</div>
                                    <div className="text-xs text-gray-400">Version Commerciale</div>
                                </div>
                            </div>
                            <div className="relative">
                                <button onClick={() => setShowUserMenu(!showUserMenu)} className="flex items-center gap-3 glass px-4 py-2 rounded-xl hover:bg-white/10 transition">
                                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                        <span className="font-bold">{currentUser.username[0].toUpperCase()}</span>
                                    </div>
                                    <div className="text-left hidden md:block">
                                        <div className="text-sm font-semibold">{currentUser.username}</div>
                                        <div className="text-xs text-gray-400">{currentUser.role === 'admin' ? 'Administrateur' : 'Commercial'}</div>
                                    </div>
                                </button>
                                {showUserMenu && (
                                    <div className="absolute right-0 mt-2 w-56 glass-card p-2 fade-in">
                                        <div className="p-3 border-b border-white/10">
                                            <div className="font-semibold">{currentUser.username}</div>
                                            <div className="text-sm text-gray-400">{currentUser.email}</div>
                                        </div>
                                        <button onClick={handleLogout} className="w-full text-left px-4 py-2 text-red-400 hover:bg-red-500/20 rounded-lg transition mt-2">
                                            üö™ D√©connexion
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-7xl mx-auto p-4 pt-24 content-padding">
                        {currentPage === 'dashboard' && <Dashboard quotes={quotes} />}
                        {currentPage === 'quotes' && <QuoteCreator onSave={saveQuote} onBack={() => setCurrentPage('dashboard')} />}
                        {currentPage === 'products' && <ProductsManager onBack={() => setCurrentPage('dashboard')} />}
                        {currentPage === 'users' && currentUser.role === 'admin' && <UsersManager currentUser={currentUser} onBack={() => setCurrentPage('dashboard')} />}
                    </div>

                    {/* Mobile Navigation */}
                    <div className="mobile-bar">
                        <div className="flex justify-around">
                            <button onClick={() => setCurrentPage('dashboard')} className={`mobile-nav-btn ${currentPage === 'dashboard' ? 'active' : ''}`}>
                                <span className="text-2xl">üìä</span>
                                <span className="text-xs font-medium">Dashboard</span>
                            </button>
                            <button onClick={() => setCurrentPage('quotes')} className={`mobile-nav-btn ${currentPage === 'quotes' ? 'active' : ''}`}>
                                <span className="text-2xl">üìù</span>
                                <span className="text-xs font-medium">Devis</span>
                            </button>
                            <button onClick={() => setCurrentPage('products')} className={`mobile-nav-btn ${currentPage === 'products' ? 'active' : ''}`}>
                                <span className="text-2xl">üì¶</span>
                                <span className="text-xs font-medium">Produits</span>
                            </button>
                            {currentUser.role === 'admin' && (
                                <button onClick={() => setCurrentPage('users')} className={`mobile-nav-btn ${currentPage === 'users' ? 'active' : ''}`}>
                                    <span className="text-2xl">üë•</span>
                                    <span className="text-xs font-medium">Users</span>
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
