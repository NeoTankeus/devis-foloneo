<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foloneo Pro - G√©n√©rateur de Devis</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 90px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            font-size: 15px;
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn:active { transform: scale(0.96); }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
        }

        .input {
            width: 100%;
            padding: 16px 18px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            color: white;
            font-size: 16px;
            margin-bottom: 14px;
            font-family: inherit;
            min-height: 52px;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.12);
        }

        .input::placeholder { color: rgba(255, 255, 255, 0.4); }

        .header {
            background: rgba(255, 255, 255, 0.06);
            padding: 14px 16px;
            margin-bottom: 20px;
            border-radius: 0 0 20px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            padding: 10px 8px;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .mobile-nav-btn {
            flex: 1;
            padding: 10px 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            border-radius: 12px;
            min-height: 56px;
        }

        .mobile-nav-btn.active {
            background: rgba(59, 130, 246, 0.18);
            color: #60a5fa;
        }

        .product-item {
            background: rgba(255, 255, 255, 0.06);
            padding: 18px;
            border-radius: 16px;
            margin-bottom: 12px;
        }

        .quantity-btn {
            min-width: 48px;
            min-height: 48px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.12);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 20px;
        }

        .hidden { display: none !important; }

        h2 { font-size: 24px; margin-bottom: 16px; }
        h3 { font-size: 18px; margin-bottom: 12px; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // √âtat global
        let state = {
            user: null,
            page: 'login',
            quotes: [],
            products: [],
            cart: [],
            clientName: '',
            discount: 0,
            coefficient: 0,
            installationDays: 0,
            accessoiresQty: 0
        };

        // Produits par d√©faut
        const defaultProducts = [
            { id: 'ajax1', name: 'Hub', price: 108.09, category: 'Centrales', supplier: 'Ajax' },
            { id: 'ajax2', name: 'Hub 2', price: 151.79, category: 'Centrales', supplier: 'Ajax' },
            { id: 'ajax3', name: 'Hub 2 - 4G', price: 227.13, category: 'Centrales', supplier: 'Ajax' },
            { id: 'ajax4', name: 'Hub 2 Plus', price: 259.4, category: 'Centrales', supplier: 'Ajax' },
            { id: 'ajax5', name: 'DoorProtect', price: 23.9, category: 'D√©tecteurs', supplier: 'Ajax' },
            { id: 'ajax6', name: 'MotionProtect', price: 40.55, category: 'D√©tecteurs', supplier: 'Ajax' },
            { id: 'ajax7', name: 'FireProtect', price: 47.27, category: 'D√©tecteurs', supplier: 'Ajax' },
            { id: 'ajax8', name: 'KeyPad Plus', price: 81.05, category: 'Claviers', supplier: 'Ajax' },
            { id: 'ajax9', name: 'HomeSiren', price: 40.55, category: 'Sir√®nes', supplier: 'Ajax' },
            { id: 'ajax10', name: 'StreetSiren', price: 176.74, category: 'Sir√®nes', supplier: 'Ajax' },
            { id: 'dahua1', name: 'NVR 4 canaux', price: 299, category: 'Enregistreurs', supplier: 'Dahua' },
            { id: 'dahua2', name: 'NVR 8 canaux', price: 449, category: 'Enregistreurs', supplier: 'Dahua' },
            { id: 'dahua3', name: 'Cam√©ra D√¥me 4MP', price: 159, category: 'Cam√©ras', supplier: 'Dahua' },
            { id: 'dahua4', name: 'Cam√©ra Tube 4MP', price: 179, category: 'Cam√©ras', supplier: 'Dahua' },
        ];

        // Initialisation
        function init() {
            if (!localStorage.getItem('foloneo_users')) {
                localStorage.setItem('foloneo_users', JSON.stringify([
                    { id: '1', username: 'admin', password: 'admin123', role: 'admin', active: true },
                    { id: '2', username: 'commercial', password: 'commercial123', role: 'commercial', active: true }
                ]));
            } else {
                const users = JSON.parse(localStorage.getItem('foloneo_users') || '[]');
                const hasCommercial = users.find(u => u.username === 'commercial');
                if (!hasCommercial) {
                    users.push({ id: '2', username: 'commercial', password: 'commercial123', role: 'commercial', active: true });
                    localStorage.setItem('foloneo_users', JSON.stringify(users));
                }
            }

            if (!localStorage.getItem('foloneo_quotes')) {
                localStorage.setItem('foloneo_quotes', JSON.stringify([]));
            }

            if (!localStorage.getItem('foloneo_products')) {
                localStorage.setItem('foloneo_products', JSON.stringify(defaultProducts));
            }

            state.quotes = JSON.parse(localStorage.getItem('foloneo_quotes') || '[]');
            state.products = JSON.parse(localStorage.getItem('foloneo_products') || '[]');
        }

        // Rendu
        function render() {
            const app = document.getElementById('app');

            if (!state.user) {
                app.innerHTML = renderLogin();
            } else {
                app.innerHTML = `
                    <div class="header">
                        <div class="logo" onclick="navigate('dashboard')">
                            <div class="logo-icon">F</div>
                            <div>
                                <div style="font-weight: bold; font-size: 18px;">Foloneo Pro</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.6);">G√©n√©rateur de Devis</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="logout()">üö™ D√©connexion</button>
                    </div>
                    <div class="container">
                        ${state.page === 'dashboard' ? renderDashboard() : ''}
                        ${state.page === 'quotes' ? renderQuotes() : ''}
                        ${state.page === 'products' && state.user.role === 'admin' ? renderProducts() : ''}
                    </div>
                    <div class="mobile-nav">
                        <button class="mobile-nav-btn ${state.page === 'dashboard' ? 'active' : ''}" onclick="navigate('dashboard')">
                            <span style="font-size: 24px;">üìä</span>
                            <span style="font-size: 11px;">Dashboard</span>
                        </button>
                        <button class="mobile-nav-btn ${state.page === 'quotes' ? 'active' : ''}" onclick="navigate('quotes')">
                            <span style="font-size: 24px;">üìù</span>
                            <span style="font-size: 11px;">Devis</span>
                        </button>
                        ${state.user.role === 'admin' ? `
                        <button class="mobile-nav-btn ${state.page === 'products' ? 'active' : ''}" onclick="navigate('products')">
                            <span style="font-size: 24px;">üõí</span>
                            <span style="font-size: 11px;">Produits</span>
                        </button>
                        ` : ''}
                    </div>
                `;
            }
        }

        function renderLogin() {
            return `
                <div class="container" style="padding-top: 100px;">
                    <div class="card" style="max-width: 400px; margin: 0 auto;">
                        <div style="text-align: center; margin-bottom: 32px;">
                            <div class="logo-icon" style="margin: 0 auto 16px;">F</div>
                            <h1>Foloneo Pro</h1>
                            <p style="color: rgba(255,255,255,0.6);">G√©n√©rateur de Devis</p>
                        </div>
                        <form onsubmit="handleLogin(event)">
                            <input type="text" class="input" id="username" placeholder="Identifiant" required />
                            <input type="password" class="input" id="password" placeholder="Mot de passe" required />
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Se connecter</button>
                        </form>
                        <div id="login-error" style="color: #ef4444; margin-top: 12px; display: none;"></div>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const total = state.quotes.length;
            const revenue = state.quotes.reduce((s, q) => s + q.total, 0);
            const avg = total > 0 ? revenue / total : 0;

            return `
                <h2>üìä Tableau de bord</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 14px;">
                    <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));">
                        <div style="font-size: 32px; margin-bottom: 8px;">üìù</div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 14px;">Total Devis</div>
                        <div style="font-size: 36px; font-weight: bold;">${total}</div>
                    </div>
                    <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));">
                        <div style="font-size: 32px; margin-bottom: 8px;">üí∞</div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 14px;">CA Total</div>
                        <div style="font-size: 36px; font-weight: bold;">${revenue.toFixed(0)} ‚Ç¨</div>
                    </div>
                    <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));">
                        <div style="font-size: 32px; margin-bottom: 8px;">üìà</div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 14px;">Devis Moyen</div>
                        <div style="font-size: 36px; font-weight: bold;">${avg.toFixed(0)} ‚Ç¨</div>
                    </div>
                </div>
                ${state.quotes.length > 0 ? `
                <div class="card" style="margin-top: 24px;">
                    <h3>üìã Derniers devis</h3>
                    ${state.quotes.slice(-5).reverse().map(q => `
                        <div style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 600; font-size: 16px;">${q.clientName}</div>
                                    <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 4px;">
                                        ${new Date(q.date).toLocaleDateString('fr-FR')}
                                    </div>
                                </div>
                                <div style="font-size: 22px; font-weight: bold; color: #3b82f6;">${q.total.toFixed(2)} ‚Ç¨</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" style="flex: 1;" onclick="exportPDF('${q.id}')">üìÑ Exporter PDF</button>
                                <button class="btn" style="flex: 1; background: rgba(239, 68, 68, 0.2);" onclick="deleteQuote('${q.id}', '${q.clientName}')">üóëÔ∏è Supprimer</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
        }

        function renderQuotes() {
            const isCommercial = state.user && state.user.role === 'commercial';
            if (isCommercial && state.coefficient === 0) {
                state.coefficient = 3;
            }

            const subtotal = state.cart.reduce((s, item) => s + (item.price * item.quantity), 0);
            const installationAmount = state.installationDays * 500;
            const accessoiresAmount = state.accessoiresQty * 200;
            const subtotalWithServices = subtotal + installationAmount + accessoiresAmount;
            const discountAmount = subtotalWithServices * (state.discount / 100);
            const totalAfterDiscount = subtotalWithServices - discountAmount;
            const total = state.coefficient > 0 ? totalAfterDiscount * state.coefficient : totalAfterDiscount;
            const locationBase = total * 0.07;
            const locationMultipliee = locationBase * 5;
            const locationTotal = locationMultipliee + total;
            const locationMensuelle = locationTotal / 48;

            return `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>üìù Nouveau Devis</h2>
                    <button class="btn btn-primary" onclick="navigate('dashboard')">‚Üê Retour</button>
                </div>
                <div class="card">
                    <h3>üë§ Client</h3>
                    <input type="text" class="input" placeholder="Nom du client *" value="${state.clientName}" onchange="state.clientName = this.value" />
                </div>
                <div class="card">
                    <h3>üõí Produits (${state.products.length})</h3>
                    ${state.products.map(p => {
                        const cartItem = state.cart.find(item => item.id === p.id);
                        const displayPrice = isCommercial ? p.price * 3 : p.price;
                        return `
                            <div class="product-item">
                                <div style="font-weight: 600; margin-bottom: 4px;">${p.name}</div>
                                <div style="font-size: 13px; color: rgba(255,255,255,0.5);">${p.category} ${p.supplier ? '‚Ä¢ ' + p.supplier : ''}</div>
                                <div style="font-size: 18px; font-weight: bold; color: #10b981; margin-top: 4px;">
                                    ${isCommercial ? '<span style="font-size: 12px; color: rgba(255,255,255,0.6);">Prix vente: </span>' : ''}
                                    ${displayPrice.toFixed(2)} ‚Ç¨
                                </div>
                                ${cartItem ? `
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding: 12px; background: rgba(16, 185, 129, 0.15); border-radius: 12px;">
                                        <div style="display: flex; gap: 14px; align-items: center;">
                                            <button class="quantity-btn" onclick="updateQty('${p.id}', ${cartItem.quantity - 1})">-</button>
                                            <span style="font-weight: bold; width: 40px; text-align: center;">${cartItem.quantity}</span>
                                            <button class="quantity-btn" onclick="updateQty('${p.id}', ${cartItem.quantity + 1})">+</button>
                                            <button style="background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); color: #ef4444; width: 32px; height: 32px; border-radius: 8px; cursor: pointer;" onclick="removeFromCart('${p.id}')">√ó</button>
                                        </div>
                                        <span style="font-weight: bold; color: #10b981;">${(p.price * cartItem.quantity).toFixed(2)} ‚Ç¨</span>
                                    </div>
                                ` : `
                                    <button class="btn btn-primary" style="width: 100%; margin-top: 12px;" onclick="addToCart('${p.id}')">+ Ajouter au devis</button>
                                `}
                            </div>
                        `;
                    }).join('')}
                </div>
                ${state.cart.length > 0 ? `
                <div class="card">
                    <h3>üìã R√©capitulatif</h3>
                    <div style="margin-bottom: 20px; padding: 16px; background: rgba(59, 130, 246, 0.08); border-radius: 12px;">
                        <h4 style="font-size: 15px; margin-bottom: 16px; color: #60a5fa;">Services additionnels</h4>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 16px; align-items: center;">
                            <label>üîß Installation (500‚Ç¨/jour)</label>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="quantity-btn" onclick="state.installationDays = Math.max(0, state.installationDays - 1); render()">-</button>
                                <span style="font-weight: bold; width: 50px; text-align: center;">${state.installationDays}</span>
                                <button class="quantity-btn" onclick="state.installationDays++; render()">+</button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <label>üì¶ Accessoires (200‚Ç¨)</label>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="quantity-btn" onclick="state.accessoiresQty = Math.max(0, state.accessoiresQty - 1); render()">-</button>
                                <span style="font-weight: bold; width: 50px; text-align: center;">${state.accessoiresQty}</span>
                                <button class="quantity-btn" onclick="state.accessoiresQty++; render()">+</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label>Remise %</label>
                        <input type="number" class="input" value="${state.discount}" min="0" max="100" onchange="state.discount = Math.max(0, Math.min(100, Number(this.value))); render()" />
                    </div>
                    ${!isCommercial ? `
                    <div style="margin-bottom: 12px;">
                        <label>Coefficient</label>
                        <input type="number" class="input" value="${state.coefficient}" min="0" step="0.1" onchange="state.coefficient = Math.max(0, Number(this.value) || 0); render()" />
                    </div>
                    ` : `
                    <div style="padding: 12px; background: rgba(16, 185, 129, 0.15); border-radius: 12px; margin-bottom: 16px;">
                        <div style="font-size: 14px; font-weight: 600; color: #10b981;">‚úì Coefficient commercial √ó3 appliqu√© automatiquement</div>
                    </div>
                    `}
                    <div style="border-top: 2px solid rgba(255,255,255,0.15); padding-top: 16px; margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>TOTAL HT:</span>
                            <span style="font-size: 24px; font-weight: bold; color: #10b981;">${total.toFixed(2)} ‚Ç¨</span>
                        </div>
                        <div style="margin-top: 16px; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                            <div style="font-size: 16px; font-weight: 600; color: #60a5fa; margin-bottom: 8px;">üìÖ Prix √† la location</div>
                            <div style="font-size: 20px; font-weight: bold; color: #60a5fa;">${locationMensuelle.toFixed(2)} ‚Ç¨ /mois</div>
                        </div>
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="saveQuote()">üíæ Enregistrer le devis</button>
                </div>
                ` : ''}
            `;
        }

        function renderProducts() {
            return `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>üõí Gestion des Produits</h2>
                    <button class="btn btn-primary" onclick="navigate('dashboard')">‚Üê Retour</button>
                </div>
                <div class="card">
                    <h3>üì¶ Catalogue (${state.products.length})</h3>
                    ${state.products.map(p => `
                        <div class="product-item">
                            <div style="font-weight: 600; margin-bottom: 4px; font-size: 16px;">${p.name}</div>
                            <div style="font-size: 13px; color: rgba(255,255,255,0.5);">${p.category} ${p.supplier ? '‚Ä¢ ' + p.supplier : ''}</div>
                            <div style="font-size: 20px; font-weight: bold; color: #3b82f6; margin-top: 6px;">${p.price.toFixed(2)} ‚Ç¨</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Actions
        function navigate(page) {
            state.page = page;
            if (page === 'quotes') {
                state.cart = [];
                state.clientName = '';
                state.discount = 0;
                state.coefficient = state.user && state.user.role === 'commercial' ? 3 : 0;
                state.installationDays = 0;
                state.accessoiresQty = 0;
            }
            render();
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = JSON.parse(localStorage.getItem('foloneo_users') || '[]');
            const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());

            if (!user || user.password !== password) {
                const errorDiv = document.getElementById('login-error');
                errorDiv.textContent = 'Identifiant ou mot de passe incorrect';
                errorDiv.style.display = 'block';
                return;
            }

            state.user = user;
            state.page = 'dashboard';
            localStorage.setItem('foloneo_current_user', JSON.stringify(user));
            render();
        }

        function logout() {
            state.user = null;
            state.page = 'login';
            localStorage.removeItem('foloneo_current_user');
            render();
        }

        function addToCart(productId) {
            const product = state.products.find(p => p.id === productId);
            const existing = state.cart.find(item => item.id === productId);

            if (existing) {
                existing.quantity++;
            } else {
                state.cart.push({...product, quantity: 0});
            }
            render();
        }

        function removeFromCart(productId) {
            state.cart = state.cart.filter(item => item.id !== productId);
            render();
        }

        function updateQty(productId, qty) {
            if (qty < 0) return;
            const item = state.cart.find(i => i.id === productId);
            if (item) {
                item.quantity = qty;
                render();
            }
        }

        function saveQuote() {
            if (!state.clientName) {
                alert('Entrez le nom du client');
                return;
            }
            if (state.cart.length === 0 && state.installationDays === 0 && state.accessoiresQty === 0) {
                alert('Ajoutez des produits ou des services');
                return;
            }

            const subtotal = state.cart.reduce((s, item) => s + (item.price * item.quantity), 0);
            const installationAmount = state.installationDays * 500;
            const accessoiresAmount = state.accessoiresQty * 200;
            const subtotalWithServices = subtotal + installationAmount + accessoiresAmount;
            const discountAmount = subtotalWithServices * (state.discount / 100);
            const totalAfterDiscount = subtotalWithServices - discountAmount;
            const total = state.coefficient > 0 ? totalAfterDiscount * state.coefficient : totalAfterDiscount;
            const locationBase = total * 0.07;
            const locationMultipliee = locationBase * 5;
            const locationTotal = locationMultipliee + total;
            const locationMensuelle = locationTotal / 48;

            const quote = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                clientName: state.clientName,
                items: state.cart,
                installationDays: state.installationDays,
                installationAmount,
                accessoiresQty: state.accessoiresQty,
                accessoiresAmount,
                subtotal: subtotalWithServices,
                discount: state.discount,
                discountAmount,
                coefficient: state.coefficient,
                total,
                locationMensuelle
            };

            state.quotes.push(quote);
            localStorage.setItem('foloneo_quotes', JSON.stringify(state.quotes));
            alert('‚úì Devis enregistr√© avec succ√®s!');
            navigate('dashboard');
        }

        function deleteQuote(quoteId, clientName) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer le devis de ${clientName} ?`)) {
                state.quotes = state.quotes.filter(q => q.id !== quoteId);
                localStorage.setItem('foloneo_quotes', JSON.stringify(state.quotes));
                alert('‚úì Devis supprim√©');
                render();
            }
        }

        function exportPDF(quoteId) {
            const quote = state.quotes.find(q => q.id === quoteId);
            if (!quote) return;

            // Cr√©er une version imprimable
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Devis ${quote.clientName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; }
                        .header { background: #2563eb; color: white; padding: 20px; text-align: center; margin-bottom: 30px; }
                        .info { margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th { background: #f0f0f0; padding: 10px; text-align: left; }
                        td { padding: 10px; border-bottom: 1px solid #eee; }
                        .total { font-size: 20px; font-weight: bold; color: #10b981; text-align: right; margin-top: 20px; }
                        .location { background: #3b82f6; color: white; padding: 15px; margin-top: 20px; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>FOLONEO PRO</h1>
                        <p>DEVIS</p>
                    </div>
                    <div class="info">
                        <p><strong>Client:</strong> ${quote.clientName}</p>
                        <p><strong>Date:</strong> ${new Date(quote.date).toLocaleDateString('fr-FR')}</p>
                        <p><strong>Devis N¬∞:</strong> ${quote.id}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>D√©signation</th>
                                <th>P.U. HT</th>
                                <th>Qt√©</th>
                                <th>Total HT</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${quote.items.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.price.toFixed(2)} ‚Ç¨</td>
                                    <td>${item.quantity}</td>
                                    <td>${(item.price * item.quantity).toFixed(2)} ‚Ç¨</td>
                                </tr>
                            `).join('')}
                            ${quote.installationDays > 0 ? `
                                <tr>
                                    <td>Installation</td>
                                    <td>500.00 ‚Ç¨</td>
                                    <td>${quote.installationDays}</td>
                                    <td>${quote.installationAmount.toFixed(2)} ‚Ç¨</td>
                                </tr>
                            ` : ''}
                            ${quote.accessoiresQty > 0 ? `
                                <tr>
                                    <td>Accessoires</td>
                                    <td>200.00 ‚Ç¨</td>
                                    <td>${quote.accessoiresQty}</td>
                                    <td>${quote.accessoiresAmount.toFixed(2)} ‚Ç¨</td>
                                </tr>
                            ` : ''}
                        </tbody>
                    </table>
                    <div class="total">TOTAL HT: ${quote.total.toFixed(2)} ‚Ç¨</div>
                    ${quote.locationMensuelle && quote.locationMensuelle > 0 ? `
                    <div class="location">
                        <strong>LOCATION MENSUELLE: ${quote.locationMensuelle.toFixed(2)} ‚Ç¨ /mois</strong>
                    </div>
                    ` : ''}
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // D√©marrage
        init();
        const stored = localStorage.getItem('foloneo_current_user');
        if (stored) {
            state.user = JSON.parse(stored);
            state.page = 'dashboard';
        }
        render();
    </script>
</body>
</html>
