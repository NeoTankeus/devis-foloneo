<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foloneo Pro - G√©n√©rateur de Devis</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.6);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            margin-bottom: 12px;
        }
        .input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.12);
        }
        .input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .product-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        .product-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(4px);
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        h1 { font-size: 32px; margin-bottom: 8px; }
        h2 { font-size: 24px; margin-bottom: 16px; }
        h3 { font-size: 18px; margin-bottom: 12px; }
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            margin-bottom: 24px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        .tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }
        .tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        .search-bar {
            width: 100%;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            margin-bottom: 16px;
        }
        .search-bar:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .btn-add {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .btn-add:active {
            transform: scale(0.9);
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .quantity-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .mobile-nav-btn {
            flex: 1;
            padding: 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            border-radius: 8px;
        }
        .mobile-nav-btn.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        @media (min-width: 768px) {
            .mobile-nav { display: none; }
        }
        .content { padding-bottom: 80px; }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn 0.3s;
            z-index: 1000;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Donn√©es produits
        const ajaxProducts = [
            { id: 'ajax1', name: 'Hub', price: 108.09, category: 'Centrales' },
            { id: 'ajax2', name: 'Hub 2', price: 151.79, category: 'Centrales' },
            { id: 'ajax3', name: 'Hub 2 - 4G', price: 227.13, category: 'Centrales' },
            { id: 'ajax4', name: 'Hub 2 Plus', price: 259.4, category: 'Centrales' },
            { id: 'ajax5', name: 'DoorProtect', price: 23.9, category: 'D√©tecteurs' },
            { id: 'ajax6', name: 'MotionProtect', price: 40.55, category: 'D√©tecteurs' },
            { id: 'ajax7', name: 'FireProtect', price: 47.27, category: 'D√©tecteurs' },
            { id: 'ajax8', name: 'KeyPad Plus', price: 81.05, category: 'Claviers' },
            { id: 'ajax9', name: 'HomeSiren', price: 40.55, category: 'Sir√®nes' },
            { id: 'ajax10', name: 'StreetSiren', price: 176.74, category: 'Sir√®nes' },
        ];

        const dahuaProducts = [
            { id: 'dahua1', name: 'NVR 4 canaux', price: 299, category: 'Enregistreurs' },
            { id: 'dahua2', name: 'NVR 8 canaux', price: 449, category: 'Enregistreurs' },
            { id: 'dahua3', name: 'Cam√©ra D√¥me 4MP', price: 159, category: 'Cam√©ras' },
            { id: 'dahua4', name: 'Cam√©ra Tube 4MP', price: 179, category: 'Cam√©ras' },
        ];

        // Init
        function init() {
            if (!localStorage.getItem('foloneo_users')) {
                localStorage.setItem('foloneo_users', JSON.stringify([
                    { id: '1', username: 'admin', password: 'admin123', role: 'admin', active: true }
                ]));
            }
            if (!localStorage.getItem('foloneo_quotes')) {
                localStorage.setItem('foloneo_quotes', JSON.stringify([]));
            }
        }

        // Login
        function LoginScreen({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                const users = JSON.parse(localStorage.getItem('foloneo_users') || '[]');
                const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());
                if (!user || user.password !== password) {
                    setError('Identifiant ou mot de passe incorrect');
                    return;
                }
                localStorage.setItem('foloneo_current_user', JSON.stringify(user));
                onLogin(user);
            };

            return (
                <div className="container" style={{paddingTop: '100px'}}>
                    <div className="card" style={{maxWidth: '400px', margin: '0 auto'}}>
                        <div style={{textAlign: 'center', marginBottom: '32px'}}>
                            <div className="logo-icon" style={{margin: '0 auto 16px'}}>F</div>
                            <h1>Foloneo Pro</h1>
                            <p style={{color: 'rgba(255,255,255,0.6)'}}>G√©n√©rateur de Devis</p>
                        </div>
                        <form onSubmit={handleLogin}>
                            <input
                                type="text"
                                className="input"
                                placeholder="Identifiant"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                            />
                            <input
                                type="password"
                                className="input"
                                placeholder="Mot de passe"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                            {error && <div style={{color: '#ef4444', marginBottom: '12px', fontSize: '14px'}}>{error}</div>}
                            <button type="submit" className="btn btn-primary" style={{width: '100%'}}>
                                Se connecter
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Dashboard
        function Dashboard({ quotes }) {
            const total = quotes.length;
            const revenue = quotes.reduce((s, q) => s + q.total, 0);
            const avg = total > 0 ? revenue / total : 0;

            return (
                <div>
                    <h2>üìä Tableau de bord</h2>
                    <div className="grid">
                        <div className="stat-card">
                            <div style={{fontSize: '32px', marginBottom: '8px'}}>üìù</div>
                            <div style={{color: 'rgba(255,255,255,0.6)', fontSize: '14px'}}>Total Devis</div>
                            <div style={{fontSize: '36px', fontWeight: 'bold'}}>{total}</div>
                        </div>
                        <div className="stat-card">
                            <div style={{fontSize: '32px', marginBottom: '8px'}}>üí∞</div>
                            <div style={{color: 'rgba(255,255,255,0.6)', fontSize: '14px'}}>CA Total</div>
                            <div style={{fontSize: '36px', fontWeight: 'bold'}}>{revenue.toFixed(0)} ‚Ç¨</div>
                        </div>
                        <div className="stat-card">
                            <div style={{fontSize: '32px', marginBottom: '8px'}}>üìà</div>
                            <div style={{color: 'rgba(255,255,255,0.6)', fontSize: '14px'}}>Devis Moyen</div>
                            <div style={{fontSize: '36px', fontWeight: 'bold'}}>{avg.toFixed(0)} ‚Ç¨</div>
                        </div>
                    </div>
                    {quotes.length > 0 && (
                        <div className="card" style={{marginTop: '24px'}}>
                            <h3>üìã Derniers devis</h3>
                            {quotes.slice(-5).reverse().map(q => (
                                <div key={q.id} style={{display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px', marginBottom: '8px'}}>
                                    <div>
                                        <div style={{fontWeight: '600'}}>{q.clientName}</div>
                                        <div style={{fontSize: '12px', color: 'rgba(255,255,255,0.6)'}}>{new Date(q.date).toLocaleDateString('fr-FR')}</div>
                                    </div>
                                    <div style={{fontSize: '20px', fontWeight: 'bold', color: '#3b82f6'}}>{q.total.toFixed(2)} ‚Ç¨</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Quote Creator
        function QuoteCreator({ onSave, onBack }) {
            const [clientName, setClientName] = useState('');
            const [cart, setCart] = useState([]);
            const [discount, setDiscount] = useState(0);
            const [tab, setTab] = useState('ajax');
            const [search, setSearch] = useState('');
            const [toast, setToast] = useState('');

            const products = tab === 'ajax' ? ajaxProducts : dahuaProducts;
            const filtered = products.filter(p => p.name.toLowerCase().includes(search.toLowerCase()));

            const addToCart = (product) => {
                const existing = cart.find(item => item.id === product.id);
                if (existing) {
                    setCart(cart.map(item => item.id === product.id ? {...item, quantity: item.quantity + 1} : item));
                } else {
                    setCart([...cart, {...product, quantity: 1}]);
                }
                setToast(`${product.name} ajout√©`);
                setTimeout(() => setToast(''), 2000);
            };

            const updateQty = (id, qty) => {
                if (qty <= 0) {
                    setCart(cart.filter(item => item.id !== id));
                } else {
                    setCart(cart.map(item => item.id === id ? {...item, quantity: qty} : item));
                }
            };

            const subtotal = cart.reduce((s, item) => s + (item.price * item.quantity), 0);
            const discountAmount = subtotal * (discount / 100);
            const total = subtotal - discountAmount;

            const handleSave = () => {
                if (!clientName) { alert('Entrez le nom du client'); return; }
                if (cart.length === 0) { alert('Ajoutez des produits'); return; }
                const quote = {
                    id: Date.now().toString(),
                    date: new Date().toISOString(),
                    clientName,
                    items: cart,
                    subtotal,
                    discount,
                    discountAmount,
                    total
                };
                onSave(quote);
            };

            return (
                <div>
                    {toast && (
                        <div className="toast">
                            <span style={{fontSize: '20px'}}>‚úì</span>
                            <span style={{fontWeight: '600'}}>{toast}</span>
                        </div>
                    )}
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                        <h2>üìù Nouveau Devis</h2>
                        <button onClick={onBack} className="btn btn-primary">‚Üê Retour</button>
                    </div>
                    <div className="card">
                        <h3>üë§ Client</h3>
                        <input
                            type="text"
                            className="input"
                            placeholder="Nom du client *"
                            value={clientName}
                            onChange={(e) => setClientName(e.target.value)}
                        />
                    </div>
                    <div className="card">
                        <h3>üõí Produits</h3>
                        <div className="tabs">
                            <button className={`tab ${tab === 'ajax' ? 'active' : ''}`} onClick={() => setTab('ajax')}>
                                Ajax ({ajaxProducts.length})
                            </button>
                            <button className={`tab ${tab === 'dahua' ? 'active' : ''}`} onClick={() => setTab('dahua')}>
                                Dahua ({dahuaProducts.length})
                            </button>
                        </div>
                        <input
                            type="text"
                            className="search-bar"
                            placeholder="üîç Rechercher..."
                            value={search}
                            onChange={(e) => setSearch(e.target.value)}
                        />
                        <div style={{maxHeight: '400px', overflowY: 'auto'}}>
                            {filtered.map(p => (
                                <div key={p.id} className="product-item">
                                    <div>
                                        <div style={{fontWeight: '600', marginBottom: '4px'}}>{p.name}</div>
                                        <div style={{fontSize: '14px', color: 'rgba(255,255,255,0.6)'}}>{p.category}</div>
                                        <div style={{fontSize: '16px', fontWeight: 'bold', color: '#3b82f6', marginTop: '4px'}}>{p.price.toFixed(2)} ‚Ç¨</div>
                                    </div>
                                    <button className="btn-add" onClick={() => addToCart(p)}>+</button>
                                </div>
                            ))}
                        </div>
                    </div>
                    {cart.length > 0 && (
                        <div className="card">
                            <h3>üõçÔ∏è Panier ({cart.length})</h3>
                            {cart.map(item => (
                                <div key={item.id} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px', marginBottom: '8px'}}>
                                    <div style={{flex: 1}}>
                                        <div style={{fontWeight: '600'}}>{item.name}</div>
                                        <div style={{fontSize: '14px', color: 'rgba(255,255,255,0.6)'}}>{item.price} ‚Ç¨ √ó {item.quantity}</div>
                                    </div>
                                    <div className="quantity-controls">
                                        <button className="quantity-btn" onClick={() => updateQty(item.id, item.quantity - 1)}>-</button>
                                        <span style={{fontWeight: 'bold', width: '32px', textAlign: 'center'}}>{item.quantity}</span>
                                        <button className="quantity-btn" onClick={() => updateQty(item.id, item.quantity + 1)}>+</button>
                                        <div style={{width: '80px', textAlign: 'right', fontWeight: 'bold', color: '#3b82f6'}}>
                                            {(item.price * item.quantity).toFixed(2)} ‚Ç¨
                                        </div>
                                    </div>
                                </div>
                            ))}
                            <div style={{marginTop: '20px', paddingTop: '20px', borderTop: '1px solid rgba(255,255,255,0.1)'}}>
                                <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px'}}>
                                    <label style={{fontSize: '14px'}}>Remise %</label>
                                    <input
                                        type="number"
                                        className="input"
                                        style={{width: '100px'}}
                                        value={discount}
                                        onChange={(e) => setDiscount(Math.max(0, Math.min(100, Number(e.target.value))))}
                                        min="0"
                                        max="100"
                                    />
                                </div>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '8px'}}>
                                    <span>Sous-total:</span>
                                    <span style={{fontWeight: '600'}}>{subtotal.toFixed(2)} ‚Ç¨</span>
                                </div>
                                {discount > 0 && (
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '8px', color: '#ef4444'}}>
                                        <span>Remise ({discount}%):</span>
                                        <span style={{fontWeight: '600'}}>-{discountAmount.toFixed(2)} ‚Ç¨</span>
                                    </div>
                                )}
                                <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '24px', fontWeight: 'bold', paddingTop: '12px', borderTop: '1px solid rgba(255,255,255,0.1)'}}>
                                    <span>TOTAL:</span>
                                    <span style={{color: '#10b981'}}>{total.toFixed(2)} ‚Ç¨</span>
                                </div>
                            </div>
                            <button onClick={handleSave} className="btn btn-success" style={{width: '100%', marginTop: '20px'}}>
                                üíæ Enregistrer le devis
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Main App
        function App() {
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('dashboard');
            const [quotes, setQuotes] = useState([]);

            useEffect(() => {
                init();
                const stored = localStorage.getItem('foloneo_current_user');
                if (stored) setUser(JSON.parse(stored));
                setQuotes(JSON.parse(localStorage.getItem('foloneo_quotes') || '[]'));
            }, []);

            const saveQuote = (quote) => {
                const all = JSON.parse(localStorage.getItem('foloneo_quotes') || '[]');
                all.push(quote);
                localStorage.setItem('foloneo_quotes', JSON.stringify(all));
                setQuotes(all);
                setPage('dashboard');
            };

            const logout = () => {
                localStorage.removeItem('foloneo_current_user');
                setUser(null);
            };

            if (!user) return <LoginScreen onLogin={setUser} />;

            return (
                <div>
                    <div className="header">
                        <div className="logo" onClick={() => setPage('dashboard')}>
                            <div className="logo-icon">F</div>
                            <div>
                                <div style={{fontWeight: 'bold', fontSize: '18px'}}>Foloneo Pro</div>
                                <div style={{fontSize: '12px', color: 'rgba(255,255,255,0.6)'}}>G√©n√©rateur de Devis</div>
                            </div>
                        </div>
                        <button onClick={logout} className="btn btn-primary">üö™ D√©connexion</button>
                    </div>
                    <div className="container content">
                        {page === 'dashboard' && <Dashboard quotes={quotes} />}
                        {page === 'quotes' && <QuoteCreator onSave={saveQuote} onBack={() => setPage('dashboard')} />}
                    </div>
                    <div className="mobile-nav">
                        <button className={`mobile-nav-btn ${page === 'dashboard' ? 'active' : ''}`} onClick={() => setPage('dashboard')}>
                            <span style={{fontSize: '24px'}}>üìä</span>
                            <span style={{fontSize: '11px'}}>Dashboard</span>
                        </button>
                        <button className={`mobile-nav-btn ${page === 'quotes' ? 'active' : ''}`} onClick={() => setPage('quotes')}>
                            <span style={{fontSize: '24px'}}>üìù</span>
                            <span style={{fontSize: '11px'}}>Devis</span>
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
