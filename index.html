<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e3a8a">
    <title>Foloneo - G√©n√©rateur de Devis</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231e3a8a' width='100' height='100'/><text y='75' font-size='80' fill='white' font-family='Arial'>F</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior: none;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .foloneo-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }

        input, select, textarea, button {
            font-size: 16px;
        }

        .mobile-optimized {
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .hide-mobile {
                display: none;
            }
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .dropdown-menu {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialiser les donn√©es utilisateurs
        const initializeUsers = () => {
            const stored = localStorage.getItem('foloneo_users');
            if (!stored) {
                const defaultUsers = [
                    {
                        id: '1',
                        username: 'admin',
                        password: 'admin123',
                        email: 'admin@foloneo.fr',
                        role: 'admin',
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('foloneo_users', JSON.stringify(defaultUsers));
                return defaultUsers;
            }
            return JSON.parse(stored);
        };

        // Composant de connexion
        function LoginScreen({ onLogin }) {
            const [mode, setMode] = useState('login'); // 'login', 'register', 'forgot'
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [email, setEmail] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                
                const users = initializeUsers();
                const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());
                
                if (!user) {
                    setError('Identifiant incorrect');
                    return;
                }
                
                if (user.password !== password) {
                    setError('Mot de passe incorrect');
                    return;
                }
                
                if (!user.active) {
                    setError('Compte d√©sactiv√©. Contactez l\'administrateur.');
                    return;
                }
                
                localStorage.setItem('foloneo_current_user', JSON.stringify(user));
                onLogin(user);
            };

            const handleRegister = (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (!username || !email || !password || !confirmPassword) {
                    setError('Tous les champs sont obligatoires');
                    return;
                }

                if (password !== confirmPassword) {
                    setError('Les mots de passe ne correspondent pas');
                    return;
                }

                if (password.length < 6) {
                    setError('Le mot de passe doit contenir au moins 6 caract√®res');
                    return;
                }

                const users = initializeUsers();
                
                if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                    setError('Cet identifiant existe d√©j√†');
                    return;
                }

                if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
                    setError('Cet email est d√©j√† utilis√©');
                    return;
                }

                const newUser = {
                    id: Date.now().toString(),
                    username: username,
                    password: password,
                    email: email,
                    role: 'user',
                    active: true,
                    createdAt: new Date().toISOString()
                };

                users.push(newUser);
                localStorage.setItem('foloneo_users', JSON.stringify(users));
                
                setSuccess('Compte cr√©√© avec succ√®s ! Vous pouvez maintenant vous connecter.');
                setTimeout(() => {
                    setMode('login');
                    setUsername(newUser.username);
                    setPassword('');
                }, 2000);
            };

            const handleForgotPassword = (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (!email) {
                    setError('Veuillez entrer votre email');
                    return;
                }

                const users = initializeUsers();
                const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

                if (!user) {
                    setError('Aucun compte trouv√© avec cet email');
                    return;
                }

                setSuccess(`Instructions envoy√©es √† ${email}. Pour cette d√©mo, votre mot de passe est: ${user.password}`);
            };

            return (
                <div className="min-h-screen foloneo-gradient flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
                        <div className="text-center mb-8">
                            <div className="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4">
                                <span className="text-3xl font-bold text-blue-600">F</span>
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800">Foloneo</h1>
                            <p className="text-gray-600">
                                {mode === 'login' && 'G√©n√©rateur de Devis'}
                                {mode === 'register' && 'Cr√©er un compte'}
                                {mode === 'forgot' && 'Mot de passe oubli√©'}
                            </p>
                        </div>

                        {mode === 'login' && (
                            <form onSubmit={handleLogin} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Identifiant
                                    </label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Votre identifiant"
                                        required
                                        autoComplete="username"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Mot de passe
                                    </label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Votre mot de passe"
                                        required
                                        autoComplete="current-password"
                                    />
                                </div>

                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                        {error}
                                    </div>
                                )}

                                {success && (
                                    <div className="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm">
                                        {success}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 mobile-optimized"
                                >
                                    Se connecter
                                </button>

                                <div className="text-center space-y-2">
                                    <button
                                        type="button"
                                        onClick={() => setMode('forgot')}
                                        className="text-blue-600 text-sm hover:underline"
                                    >
                                        Mot de passe oubli√© ?
                                    </button>
                                    <div className="text-gray-600 text-sm">
                                        Pas encore de compte ?{' '}
                                        <button
                                            type="button"
                                            onClick={() => setMode('register')}
                                            className="text-blue-600 font-semibold hover:underline"
                                        >
                                            Cr√©er un compte
                                        </button>
                                    </div>
                                </div>

                                <div className="mt-6 pt-6 border-t border-gray-200">
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <p className="text-sm font-semibold text-blue-900 mb-2">Compte d√©mo :</p>
                                        <p className="text-sm text-blue-700">
                                            <strong>Identifiant:</strong> admin<br/>
                                            <strong>Mot de passe:</strong> admin123
                                        </p>
                                    </div>
                                </div>
                            </form>
                        )}

                        {mode === 'register' && (
                            <form onSubmit={handleRegister} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Identifiant
                                    </label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Choisissez un identifiant"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Email
                                    </label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="votre@email.com"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Mot de passe
                                    </label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Minimum 6 caract√®res"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Confirmer le mot de passe
                                    </label>
                                    <input
                                        type="password"
                                        value={confirmPassword}
                                        onChange={(e) => setConfirmPassword(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Confirmez votre mot de passe"
                                        required
                                    />
                                </div>

                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                        {error}
                                    </div>
                                )}

                                {success && (
                                    <div className="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm">
                                        {success}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 mobile-optimized"
                                >
                                    Cr√©er mon compte
                                </button>

                                <div className="text-center">
                                    <button
                                        type="button"
                                        onClick={() => setMode('login')}
                                        className="text-blue-600 text-sm hover:underline"
                                    >
                                        ‚Üê Retour √† la connexion
                                    </button>
                                </div>
                            </form>
                        )}

                        {mode === 'forgot' && (
                            <form onSubmit={handleForgotPassword} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Email
                                    </label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="votre@email.com"
                                        required
                                    />
                                </div>

                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                        {error}
                                    </div>
                                )}

                                {success && (
                                    <div className="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm whitespace-pre-line">
                                        {success}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 mobile-optimized"
                                >
                                    R√©cup√©rer mon mot de passe
                                </button>

                                <div className="text-center">
                                    <button
                                        type="button"
                                        onClick={() => setMode('login')}
                                        className="text-blue-600 text-sm hover:underline"
                                    >
                                        ‚Üê Retour √† la connexion
                                    </button>
                                </div>
                            </form>
                        )}
                    </div>
                </div>
            );
        }

        // Application principale (simplifi√©e pour le test)
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [showUserMenu, setShowUserMenu] = useState(false);

            useEffect(() => {
                const stored = localStorage.getItem('foloneo_current_user');
                if (stored) {
                    setCurrentUser(JSON.parse(stored));
                }
            }, []);

            const handleLogout = () => {
                localStorage.removeItem('foloneo_current_user');
                setCurrentUser(null);
            };

            if (!currentUser) {
                return <LoginScreen onLogin={setCurrentUser} />;
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="foloneo-gradient text-white p-4 shadow-lg">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center space-x-3">
                                <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                                    <span className="text-2xl font-bold text-blue-600">F</span>
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold">Foloneo</h1>
                                    <p className="text-sm opacity-90">G√©n√©rateur de Devis</p>
                                </div>
                            </div>

                            {/* Menu utilisateur */}
                            <div className="relative">
                                <button
                                    onClick={() => setShowUserMenu(!showUserMenu)}
                                    className="flex items-center space-x-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition"
                                >
                                    <div className="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                                        <span className="text-blue-600 font-bold">{currentUser.username[0].toUpperCase()}</span>
                                    </div>
                                    <div className="text-left hide-mobile">
                                        <div className="text-sm font-semibold">{currentUser.username}</div>
                                        <div className="text-xs opacity-75">{currentUser.role === 'admin' ? 'Administrateur' : 'Utilisateur'}</div>
                                    </div>
                                </button>

                                {showUserMenu && (
                                    <div className="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl dropdown-menu z-50">
                                        <div className="p-4 border-b border-gray-100">
                                            <div className="font-semibold text-gray-800">{currentUser.username}</div>
                                            <div className="text-sm text-gray-600">{currentUser.email}</div>
                                            <div className="text-xs text-blue-600 mt-1">
                                                {currentUser.role === 'admin' ? 'üëë Administrateur' : 'üë§ Utilisateur'}
                                            </div>
                                        </div>
                                        <div className="p-2">
                                            <button
                                                onClick={handleLogout}
                                                className="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition"
                                            >
                                                üö™ D√©connexion
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Contenu principal */}
                    <div className="max-w-7xl mx-auto p-6">
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                Bienvenue, {currentUser.username} ! üéâ
                            </h2>
                            <div className="space-y-4">
                                <div className="bg-green-50 border border-green-200 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-3">
                                        <div className="text-4xl">‚úÖ</div>
                                        <div>
                                            <h3 className="text-xl font-bold text-green-800">Connexion r√©ussie !</h3>
                                            <p className="text-green-700">Le syst√®me d'authentification fonctionne correctement</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                                    <h3 className="text-lg font-bold text-blue-900 mb-3">Informations de votre compte :</h3>
                                    <div className="space-y-2 text-blue-800">
                                        <p><strong>Identifiant :</strong> {currentUser.username}</p>
                                        <p><strong>Email :</strong> {currentUser.email}</p>
                                        <p><strong>R√¥le :</strong> {currentUser.role === 'admin' ? 'Administrateur' : 'Utilisateur'}</p>
                                        <p><strong>Statut :</strong> {currentUser.active ? 'üü¢ Actif' : 'üî¥ Inactif'}</p>
                                        <p><strong>Compte cr√©√© le :</strong> {new Date(currentUser.createdAt).toLocaleDateString('fr-FR')}</p>
                                    </div>
                                </div>

                                <div className="bg-gray-50 border border-gray-200 p-6 rounded-lg">
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">üìã Prochaines √©tapes :</h3>
                                    <ul className="list-disc list-inside space-y-2 text-gray-700">
                                        <li>Int√©gration du module de cr√©ation de devis</li>
                                        <li>Gestion des produits Ajax et Dahua</li>
                                        <li>G√©n√©ration de PDF professionnels</li>
                                        <li>Tableau de bord avec statistiques</li>
                                        <li>Module de gestion des utilisateurs (pour admin)</li>
                                    </ul>
                                </div>

                                <div className="bg-yellow-50 border border-yellow-200 p-6 rounded-lg">
                                    <h3 className="text-lg font-bold text-yellow-900 mb-2">üí° Astuce :</h3>
                                    <p className="text-yellow-800">
                                        Cliquez sur votre nom en haut √† droite pour acc√©der au menu utilisateur et vous d√©connecter.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Initialiser l'application
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
